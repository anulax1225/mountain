<template class="flex">
    <div id="loader"
        class="hidden fixed z-40 bg-black/50 top-0 right-0 left-0 bottom-0 flex items-center justify-center">
        <rdmetal-eye class="h-32 load-rotate"></rdmetal-eye>
    </div>
    <nav class="w-96 min-h-screen flex flex-col justify-between border-r border-gray-200 bg-gray-50">
        <div>
            <div class="flex items-center gap-2 px-4 py-4 border-b border-gray-200">
                <rdmetal-eye class="w-8 h-fit"></rdmetal-eye>
                <p class="font-medium text-lg">Suivi RD Metal</p>
            </div>

            <div class="flex-1 overflow-auto pt-2">
                <div class="px-3 py-4">
                    <div class="grid grid-cols-6 px-1 gap-2 mb-1">
                        <div class="text-center px-2 py-0.5 rounded-lg shadow-sm bg-red-500 text-white">
                            <p x-format>{{ $props.delayedComms.toString() }}</p>
                        </div>
                        <p class="font-semibold col-span-5">Délai dépassé</p>
                    </div>
                    <div class="grid grid-cols-6 px-1 gap-2 mb-4">
                        <div class="text-center px-2 py-0.5 rounded-lg shadow-sm bg-gray-400 text-white">
                            <p x-format>{{ $props.pendingComms.toString() }}</p>
                        </div>
                        <p class="font-semibold col-span-5">Sans réponse(s)</p>
                    </div>
                    <h2 class="mb-2 px-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider">
                        Général
                    </h2>
                    <ul class="space-y-0.5">
                        <template x-for="item in mainItems">
                            <li>
                                <a x-format :href="item.path"
                                    class="flex items-center gap-3 rounded-lg px-3 py-1 text-md font-medium hover:bg-gray-100"
                                    :class="window.location.pathname === item.path ? 'bg-gray-100' : ''">
                                    {{ item.name }}
                                </a>
                            </li>
                        </template>
                    </ul>
                </div>

                <div x-show="$props.user.est_admin" class="px-3 py-4 mt-2">
                    <h2 class="mb-2 px-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider">
                        Administration
                    </h2>
                    <ul>
                        <template x-for="item in secondaryItems">
                            <li>
                                <a x-format :href="item.path"
                                    class="flex items-center gap-3 rounded-lg px-3 py-1 my-0.5 text-md hover:bg-gray-100"
                                    :class="window.location.pathname === item.path ? 'bg-gray-100' : ''">
                                    {{ item.name }}
                                </a>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>
        <ui-user-info #user="$props.user" class="border-t border-gray-200"></ui-user-info>
    </nav>
    <div class="w-full relative">
        <slot></slot>
    </div>
</template>

<script setup>
    const props = defineProps({
        user: {
            type: Object,
            default: {},
        },
        delayedComms: {
            type: Number,
            default: 0,
        },
        pendingComms: {
            type: Number,
            default: 0,
        }
    });
    
    return {
        evalBlur(e, callback) {
            if (!this.$refs.menuBar.contains(e.relatedTarget)) {
                callback();
            }
        },
        mainItems: [
            {
                name: "Dashboard",
                path: "/projets",
            },
        ],
        secondaryItems: [
            {
                name: "Utilisateur",
                path: "/users",
            },
            {
                name: "Entreprise",
                path: "/entreprises",
            },
            {
                name: "Type de communication",
                path: "/types",
            },
            {
                name: "Modèle de question",
                path: "/modeles",
            },
        ],
    }
</script>